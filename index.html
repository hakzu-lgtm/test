<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë“œë¡  ëŒ€ì—¬ ì‹œìŠ¤í…œ</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' fill='%23f5f0e6' rx='8'/%3E%3Crect x='26' y='26' width='12' height='12' rx='2' fill='%23333'/%3E%3Crect x='10' y='30' width='44' height='4' rx='2' fill='%23555'/%3E%3Crect x='30' y='10' width='4' height='44' rx='2' fill='%23555'/%3E%3Ccircle cx='12' cy='12' r='9' fill='none' stroke='%23e57373' stroke-width='3'/%3E%3Ccircle cx='52' cy='12' r='9' fill='none' stroke='%23e57373' stroke-width='3'/%3E%3Ccircle cx='12' cy='52' r='9' fill='none' stroke='%23e57373' stroke-width='3'/%3E%3Ccircle cx='52' cy='52' r='9' fill='none' stroke='%23e57373' stroke-width='3'/%3E%3Ccircle cx='12' cy='12' r='3' fill='%23333'/%3E%3Ccircle cx='52' cy='12' r='3' fill='%23333'/%3E%3Ccircle cx='12' cy='52' r='3' fill='%23333'/%3E%3Ccircle cx='52' cy='52' r='3' fill='%23333'/%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f0e6 0%, #e8e0d0 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header h1 {
            color: #333;
            font-size: 2.5rem;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: white;
            color: #333;
            border: 2px solid #ddd;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #f5f5f5;
            border-color: #1565c0;
        }

        .tab-btn.active {
            background: #1565c0;
            color: white;
            border-color: #1565c0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 25px;
            margin-bottom: 20px;
        }

        /* Alert Section */
        .alert-section {
            margin-bottom: 20px;
        }

        .alert-card {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-card.urgent {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .alert-card .alert-icon {
            font-size: 1.5rem;
        }

        .alert-card .alert-content {
            flex: 1;
        }

        .alert-card .alert-title {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .alert-card .alert-detail {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Calendar Styles */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h2 {
            color: #1565c0;
            font-size: 1.5rem;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            background: linear-gradient(135deg, #1565c0 0%, #1e88e5 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .calendar-nav button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(21, 101, 192, 0.4);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day-header {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            color: #1565c0;
            font-size: 0.9rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 60px;
            border: 2px solid transparent;
        }

        .calendar-day:not(.empty):hover {
            background: #e3f2fd;
            transform: scale(1.05);
        }

        .calendar-day.today {
            background: linear-gradient(135deg, #1565c0 0%, #1e88e5 100%);
            color: white;
        }

        .calendar-day.selected {
            border: 3px solid #1565c0;
            background: #e3f2fd;
        }

        .calendar-day.range-start {
            background: linear-gradient(135deg, #1565c0 0%, #1e88e5 100%);
            color: white;
            border-radius: 12px 0 0 12px;
        }

        .calendar-day.range-end {
            background: linear-gradient(135deg, #1565c0 0%, #1e88e5 100%);
            color: white;
            border-radius: 0 12px 12px 0;
        }

        .calendar-day.range-middle {
            background: #bbdefb;
            border-radius: 0;
        }

        .calendar-day.range-start.range-end {
            border-radius: 12px;
        }

        .calendar-day.today.selected,
        .calendar-day.today.range-start,
        .calendar-day.today.range-end {
            background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%);
        }

        .calendar-day .date-number {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .calendar-day .rental-indicator {
            font-size: 0.7rem;
            margin-top: 4px;
            padding: 2px 6px;
            border-radius: 10px;
            background: #4CAF50;
            color: white;
        }

        .calendar-day.has-rentals .rental-indicator {
            background: #ff9800;
        }

        .calendar-day.sunday .date-number {
            color: #e53935;
        }

        .calendar-day.today.sunday .date-number,
        .calendar-day.range-start.sunday .date-number,
        .calendar-day.range-end.sunday .date-number {
            color: white;
        }

        .calendar-day.saturday .date-number {
            color: #1e88e5;
        }

        .calendar-day.today.saturday .date-number,
        .calendar-day.range-start.saturday .date-number,
        .calendar-day.range-end.saturday .date-number {
            color: white;
        }

        /* Date Selection Info */
        .date-selection-info {
            margin-top: 15px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            text-align: center;
        }

        .date-selection-info p {
            color: #1565c0;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .date-selection-info .dates {
            font-weight: bold;
            color: #0d47a1;
            font-size: 1rem;
        }

        .clear-selection-btn {
            margin-top: 10px;
            background: #78909c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s;
        }

        .clear-selection-btn:hover {
            background: #607d8b;
        }

        /* Form Styles */
        .rental-form h3 {
            color: #1565c0;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #1565c0;
            box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.2);
        }

        .form-group select option:disabled {
            color: #999;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .date-display {
            background: #f5f5f5;
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            color: #666;
        }

        .date-display.active {
            background: #e3f2fd;
            border-color: #1565c0;
            color: #1565c0;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #1565c0 0%, #1e88e5 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(21, 101, 192, 0.4);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Status Styles */
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .status-header h3 {
            color: #1565c0;
        }

        .export-btn {
            background: linear-gradient(135deg, #43a047 0%, #66bb6a 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 160, 71, 0.4);
        }

        .equipment-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .equipment-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            transition: transform 0.2s;
        }

        .equipment-card:hover {
            transform: translateY(-3px);
        }

        .equipment-card h4 {
            color: #1565c0;
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .equipment-card .status-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            color: white;
        }

        .status-badge.normal {
            background: #4CAF50;
        }

        .status-badge.repair {
            background: #ff9800;
        }

        .status-badge.disposed {
            background: #9e9e9e;
        }

        .equipment-card .status-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .equipment-card .status-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .status-available {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
        }

        .status-warning {
            background: linear-gradient(90deg, #ff9800, #ffc107);
        }

        .status-full {
            background: linear-gradient(90deg, #f44336, #ef5350);
        }

        .equipment-card .counts {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #666;
        }

        .counts .available {
            color: #4CAF50;
            font-weight: bold;
        }

        .counts .rented {
            color: #f44336;
            font-weight: bold;
        }

        /* Rental List Styles */
        .rental-list h4 {
            color: #1565c0;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .rental-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .rental-item.returning-soon {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }

        .rental-item.overdue {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        .rental-item .info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .rental-item .equipment-name {
            background: linear-gradient(135deg, #1565c0 0%, #1e88e5 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        .rental-item .renter-name {
            color: #333;
            font-weight: 500;
        }

        .rental-item .rental-period {
            color: #666;
            font-size: 0.85rem;
            background: #e3f2fd;
            padding: 4px 10px;
            border-radius: 12px;
        }

        .rental-item .days-left {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 8px;
            font-weight: bold;
        }

        .days-left.warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .days-left.danger {
            background: #ffebee;
            color: #d32f2f;
        }

        .cancel-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s, transform 0.2s;
        }

        .cancel-btn:hover {
            background: #d32f2f;
            transform: scale(1.05);
        }

        .no-rentals {
            text-align: center;
            color: #999;
            padding: 30px;
            font-style: italic;
        }

        /* Equipment Management Styles */
        .equipment-management {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .equipment-manage-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }

        .equipment-manage-card h4 {
            color: #1565c0;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .equipment-manage-card .quantity {
            font-size: 0.9rem;
            color: #666;
        }

        .status-summary {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .status-summary .status-item {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-summary .status-item.normal {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-summary .status-item.repair {
            background: #fff3e0;
            color: #f57c00;
        }


        .status-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .status-control-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-control-row label {
            width: 60px;
            font-size: 0.9rem;
            color: #555;
        }

        .status-control-row button {
            width: 32px;
            height: 32px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .status-control-row button:hover {
            background: #1565c0;
            color: white;
            border-color: #1565c0;
        }

        .status-control-row span {
            width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .dashboard-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .dashboard-card h3 {
            color: #1565c0;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1565c0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .chart-container {
            margin-top: 15px;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bar-label {
            width: 100px;
            font-size: 0.85rem;
            color: #555;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bar-track {
            flex: 1;
            height: 24px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 0.75rem;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .bar-fill.blue {
            background: linear-gradient(90deg, #1565c0, #42a5f5);
        }

        .bar-fill.green {
            background: linear-gradient(90deg, #43a047, #66bb6a);
        }

        .bar-fill.orange {
            background: linear-gradient(90deg, #ff9800, #ffb74d);
        }

        .top-list {
            list-style: none;
        }

        .top-list li {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .top-list li:last-child {
            border-bottom: none;
        }

        .top-list .rank {
            width: 30px;
            height: 30px;
            background: #1565c0;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85rem;
            margin-right: 10px;
        }

        .top-list .rank.gold {
            background: linear-gradient(135deg, #ffd700, #ffb300);
        }

        .top-list .rank.silver {
            background: linear-gradient(135deg, #c0c0c0, #9e9e9e);
        }

        .top-list .rank.bronze {
            background: linear-gradient(135deg, #cd7f32, #a0522d);
        }

        .usage-rate {
            font-weight: bold;
            color: #1565c0;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }

        .toast.error {
            background: linear-gradient(135deg, #f44336, #ef5350);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .card {
                padding: 15px;
            }

            .calendar-day {
                min-height: 45px;
            }

            .calendar-day .date-number {
                font-size: 0.9rem;
            }

            .calendar-day .rental-indicator {
                font-size: 0.6rem;
                padding: 1px 4px;
            }

            .calendar-nav button {
                padding: 8px 12px;
                font-size: 0.9rem;
            }

            .equipment-status {
                grid-template-columns: 1fr;
            }

            .rental-item {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .status-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .tab-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .calendar-day-header {
                font-size: 0.75rem;
                padding: 5px;
            }

            .calendar-grid {
                gap: 3px;
            }

            .calendar-header {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ë“œë¡  ëŒ€ì—¬ ì‹œìŠ¤í…œ</h1>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button type="button" class="tab-btn active" onclick="switchTab('rental')">ëŒ€ì—¬ ê´€ë¦¬</button>
            <button type="button" class="tab-btn" onclick="switchTab('dashboard')">ëŒ€ì‹œë³´ë“œ</button>
            <button type="button" class="tab-btn" onclick="switchTab('equipment')">ì¥ë¹„ ê´€ë¦¬</button>
        </div>

        <!-- Alert Section -->
        <div class="alert-section" id="alertSection"></div>

        <!-- Rental Tab -->
        <div id="rentalTab" class="tab-content active">
            <div class="main-content">
                <div class="card">
                    <div class="calendar-header">
                        <h2 id="currentMonth"></h2>
                        <div class="calendar-nav">
                            <button type="button" onclick="changeMonth(-1)">&lt; ì´ì „</button>
                            <button type="button" onclick="goToToday()">ì˜¤ëŠ˜</button>
                            <button type="button" onclick="changeMonth(1)">ë‹¤ìŒ &gt;</button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                    <div class="date-selection-info">
                        <p>ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ í´ë¦­í•˜ì—¬ ëŒ€ì—¬ ê¸°ê°„ì„ ì„ íƒí•˜ì„¸ìš”</p>
                        <div class="dates" id="selectedDatesDisplay">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                        <button type="button" class="clear-selection-btn" onclick="clearDateSelection()">ì„ íƒ ì´ˆê¸°í™”</button>
                    </div>
                </div>

                <div class="card rental-form">
                    <h3>ëŒ€ì—¬ ì‹ ì²­</h3>
                    <form id="rentalForm" onsubmit="return handleSubmit(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì‹œì‘ì¼</label>
                                <div class="date-display" id="startDateDisplay">ì‹œì‘ì¼ì„ ì„ íƒí•˜ì„¸ìš”</div>
                            </div>
                            <div class="form-group">
                                <label>ì¢…ë£Œì¼</label>
                                <div class="date-display" id="endDateDisplay">ì¢…ë£Œì¼ì„ ì„ íƒí•˜ì„¸ìš”</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="equipment">ì¥ë¹„ ì„ íƒ</label>
                            <select id="equipment" required>
                                <option value="">ì¥ë¹„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="renterName">ëŒ€ì—¬ì ì´ë¦„</label>
                            <input type="text" id="renterName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                        <button type="submit" class="submit-btn" id="submitBtn" disabled>ëŒ€ì—¬ ì‹ ì²­</button>
                    </form>
                </div>
            </div>

            <div class="card status-section">
                <div class="status-header">
                    <h3>ëŒ€ì—¬ í˜„í™© <span id="statusDateRange"></span></h3>
                    <button type="button" class="export-btn" onclick="exportToCSV()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="18" height="18">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        CSV ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
                <div class="equipment-status" id="equipmentStatus"></div>
                <div class="rental-list">
                    <h4>ëŒ€ì—¬ì ëª©ë¡</h4>
                    <div id="rentalList"></div>
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content">
            <div class="dashboard-grid" id="dashboardGrid"></div>
        </div>

        <!-- Equipment Management Tab -->
        <div id="equipmentTab" class="tab-content">
            <div class="card">
                <h3 style="color: #1565c0; margin-bottom: 20px;">ì¥ë¹„ ìƒíƒœ ê´€ë¦¬</h3>
                <p style="color: #666; margin-bottom: 20px;">ê° ì¥ë¹„ì˜ ìƒíƒœë¥¼ ì„¤ì •í•˜ì„¸ìš”. ìˆ˜ë¦¬ì¤‘ì´ë‚˜ íê¸° ìƒíƒœì˜ ì¥ë¹„ëŠ” ëŒ€ì—¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                <div class="equipment-management" id="equipmentManagement"></div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // Equipment Configuration
        var EQUIPMENT_CONFIG = {
            'M350K': 2,
            'M3E': 3,
            'M3M': 2,
            'M3T': 1,
            'Dock2': 1,
            'M3 PRO CINE': 2,
            'AVATA2': 6,
            'mini4 PRO': 15,
            'NEO': 15,
            'AIR3': 1,
            'FIFISH V6': 1,
            'Unitree GO2': 1
        };

        // Equipment Status: { name: { normal: n, repair: n, disposed: n } }
        var equipmentStatus = {};

        // State
        var currentDate = new Date();
        var startDate = null;
        var endDate = null;
        var selectionMode = 'start';
        var rentals = {};

        // Initialize
        window.onload = function() {
            loadRentals();
            cleanupOldRentals();
            loadEquipmentStatus();
            renderCalendar();
            updateFormDisplay();
            updateStatus();
            updateAlerts();
            renderEquipmentManagement();
        };

        // Tab Functions
        function switchTab(tabName) {
            var tabs = document.querySelectorAll('.tab-content');
            var btns = document.querySelectorAll('.tab-btn');

            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (var i = 0; i < btns.length; i++) {
                btns[i].classList.remove('active');
            }

            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                renderDashboard();
            }
        }

        // LocalStorage Functions
        function loadRentals() {
            try {
                var saved = localStorage.getItem('equipmentRentals');
                rentals = saved ? JSON.parse(saved) : {};
            } catch (e) {
                rentals = {};
            }
        }

        function saveRentals() {
            try {
                localStorage.setItem('equipmentRentals', JSON.stringify(rentals));
            } catch (e) {
                showToast('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // Clean up old equipment rentals that are not in current config
        function cleanupOldRentals() {
            var cleaned = false;
            var keys = Object.keys(rentals);
            for (var i = 0; i < keys.length; i++) {
                var key = keys[i];
                var dayRentals = rentals[key];
                var newList = [];
                for (var j = 0; j < dayRentals.length; j++) {
                    if (EQUIPMENT_CONFIG[dayRentals[j].equipment] !== undefined) {
                        newList.push(dayRentals[j]);
                    } else {
                        cleaned = true;
                    }
                }
                if (newList.length === 0) {
                    delete rentals[key];
                } else {
                    rentals[key] = newList;
                }
            }
            if (cleaned) {
                saveRentals();
            }
        }

        function loadEquipmentStatus() {
            try {
                var saved = localStorage.getItem('equipmentStatus');
                equipmentStatus = saved ? JSON.parse(saved) : {};

                // Initialize all equipment with detailed status
                var names = Object.keys(EQUIPMENT_CONFIG);
                for (var i = 0; i < names.length; i++) {
                    var name = names[i];
                    var total = EQUIPMENT_CONFIG[name];
                    if (!equipmentStatus[name] || typeof equipmentStatus[name] === 'string') {
                        equipmentStatus[name] = {
                            normal: total,
                            repair: 0
                        };
                    }
                    // Remove disposed if exists from old data
                    if (equipmentStatus[name].disposed !== undefined) {
                        delete equipmentStatus[name].disposed;
                    }
                }
            } catch (e) {
                equipmentStatus = {};
            }
        }

        function saveEquipmentStatus() {
            try {
                localStorage.setItem('equipmentStatus', JSON.stringify(equipmentStatus));
            } catch (e) {
                showToast('ì¥ë¹„ ìƒíƒœ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // Alert Functions
        function updateAlerts() {
            var alertSection = document.getElementById('alertSection');
            alertSection.innerHTML = '';

            var today = new Date();
            today.setHours(0, 0, 0, 0);

            var alerts = [];

            // Check all rentals for returning soon or overdue
            var keys = Object.keys(rentals);
            for (var i = 0; i < keys.length; i++) {
                var dayRentals = rentals[keys[i]];
                for (var j = 0; j < dayRentals.length; j++) {
                    var rental = dayRentals[j];
                    var endD = new Date(rental.endDate);
                    endD.setHours(0, 0, 0, 0);

                    var diffDays = Math.ceil((endD - today) / (1000 * 60 * 60 * 24));

                    if (diffDays < 0) {
                        alerts.push({
                            type: 'overdue',
                            days: Math.abs(diffDays),
                            rental: rental
                        });
                    } else if (diffDays <= 2) {
                        alerts.push({
                            type: 'returning',
                            days: diffDays,
                            rental: rental
                        });
                    }
                }
            }

            // Sort: overdue first, then by days
            alerts.sort(function(a, b) {
                if (a.type === 'overdue' && b.type !== 'overdue') return -1;
                if (a.type !== 'overdue' && b.type === 'overdue') return 1;
                return a.days - b.days;
            });

            // Render alerts (max 5)
            var maxAlerts = Math.min(alerts.length, 5);
            for (var i = 0; i < maxAlerts; i++) {
                var alert = alerts[i];
                var card = document.createElement('div');
                card.className = 'alert-card' + (alert.type === 'overdue' ? ' urgent' : '');

                var icon = alert.type === 'overdue' ? 'âš ï¸' : 'ğŸ””';
                var title = alert.type === 'overdue'
                    ? 'ë°˜ë‚© ê¸°í•œ ' + alert.days + 'ì¼ ì´ˆê³¼!'
                    : (alert.days === 0 ? 'ì˜¤ëŠ˜ ë°˜ë‚© ì˜ˆì •!' : alert.days + 'ì¼ í›„ ë°˜ë‚© ì˜ˆì •');

                card.innerHTML = '<div class="alert-icon">' + icon + '</div>' +
                    '<div class="alert-content">' +
                    '<div class="alert-title">' + title + '</div>' +
                    '<div class="alert-detail">' + alert.rental.renterName + ' - ' + alert.rental.equipment + '</div>' +
                    '</div>';

                alertSection.appendChild(card);
            }
        }

        // Calendar Functions
        function renderCalendar() {
            var year = currentDate.getFullYear();
            var month = currentDate.getMonth();

            document.getElementById('currentMonth').textContent = year + 'ë…„ ' + (month + 1) + 'ì›”';

            var grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            var days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            for (var i = 0; i < days.length; i++) {
                var header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = days[i];
                grid.appendChild(header);
            }

            var firstDay = new Date(year, month, 1).getDay();
            var totalDays = new Date(year, month + 1, 0).getDate();
            var today = new Date();

            for (var i = 0; i < firstDay; i++) {
                var empty = document.createElement('div');
                empty.className = 'calendar-day empty';
                grid.appendChild(empty);
            }

            for (var day = 1; day <= totalDays; day++) {
                var dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';

                var date = new Date(year, month, day);
                var dayOfWeek = date.getDay();

                if (dayOfWeek === 0) dayEl.classList.add('sunday');
                if (dayOfWeek === 6) dayEl.classList.add('saturday');

                if (date.toDateString() === today.toDateString()) {
                    dayEl.classList.add('today');
                }

                if (startDate && endDate) {
                    var dateTime = date.getTime();
                    var startTime = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate()).getTime();
                    var endTime = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate()).getTime();

                    if (dateTime === startTime && dateTime === endTime) {
                        dayEl.classList.add('range-start', 'range-end');
                    } else if (dateTime === startTime) {
                        dayEl.classList.add('range-start');
                    } else if (dateTime === endTime) {
                        dayEl.classList.add('range-end');
                    } else if (dateTime > startTime && dateTime < endTime) {
                        dayEl.classList.add('range-middle');
                    }
                } else if (startDate && date.toDateString() === startDate.toDateString()) {
                    dayEl.classList.add('selected');
                }

                var dateNumber = document.createElement('span');
                dateNumber.className = 'date-number';
                dateNumber.textContent = day;
                dayEl.appendChild(dateNumber);

                var dayRentals = getRentalsForDate(date);
                if (dayRentals.length > 0) {
                    dayEl.classList.add('has-rentals');
                    var indicator = document.createElement('span');
                    indicator.className = 'rental-indicator';
                    indicator.textContent = dayRentals.length + 'ê±´';
                    dayEl.appendChild(indicator);
                }

                (function(d) {
                    dayEl.onclick = function() { selectDate(d); };
                })(new Date(date));

                grid.appendChild(dayEl);
            }
        }

        function getRentalsForDate(date) {
            var results = [];
            var dateTime = new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime();

            var keys = Object.keys(rentals);
            for (var i = 0; i < keys.length; i++) {
                var dayRentals = rentals[keys[i]];
                for (var j = 0; j < dayRentals.length; j++) {
                    var rental = dayRentals[j];
                    var rentalStart = new Date(rental.startDate).getTime();
                    var rentalEnd = new Date(rental.endDate).getTime();
                    if (dateTime >= rentalStart && dateTime <= rentalEnd) {
                        results.push(rental);
                    }
                }
            }

            return results;
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            renderCalendar();
        }

        function selectDate(date) {
            if (selectionMode === 'start' || !startDate) {
                startDate = new Date(date);
                endDate = null;
                selectionMode = 'end';
            } else {
                if (date < startDate) {
                    endDate = new Date(startDate);
                    startDate = new Date(date);
                } else {
                    endDate = new Date(date);
                }
                selectionMode = 'start';
            }

            renderCalendar();
            updateFormDisplay();
            updateEquipmentSelect();
            updateStatus();
        }

        function clearDateSelection() {
            startDate = null;
            endDate = null;
            selectionMode = 'start';
            renderCalendar();
            updateFormDisplay();
            updateEquipmentSelect();
            updateStatus();
        }

        function updateFormDisplay() {
            var startDisplay = document.getElementById('startDateDisplay');
            var endDisplay = document.getElementById('endDateDisplay');
            var datesDisplay = document.getElementById('selectedDatesDisplay');
            var submitBtn = document.getElementById('submitBtn');

            if (startDate) {
                startDisplay.textContent = formatDisplayDate(startDate);
                startDisplay.classList.add('active');
            } else {
                startDisplay.textContent = 'ì‹œì‘ì¼ì„ ì„ íƒí•˜ì„¸ìš”';
                startDisplay.classList.remove('active');
            }

            if (endDate) {
                endDisplay.textContent = formatDisplayDate(endDate);
                endDisplay.classList.add('active');
            } else {
                endDisplay.textContent = 'ì¢…ë£Œì¼ì„ ì„ íƒí•˜ì„¸ìš”';
                endDisplay.classList.remove('active');
            }

            if (startDate && endDate) {
                var days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                datesDisplay.textContent = formatDisplayDate(startDate) + ' ~ ' + formatDisplayDate(endDate) + ' (' + days + 'ì¼)';
                submitBtn.disabled = false;
            } else if (startDate) {
                datesDisplay.textContent = formatDisplayDate(startDate) + ' ~ ì¢…ë£Œì¼ì„ ì„ íƒí•˜ì„¸ìš”';
                submitBtn.disabled = true;
            } else {
                datesDisplay.textContent = 'ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”';
                submitBtn.disabled = true;
            }
        }

        // Form Functions
        function handleSubmit(e) {
            e.preventDefault();

            var equipment = document.getElementById('equipment').value;
            var renterName = document.getElementById('renterName').value.trim();

            if (!startDate || !endDate) {
                showToast('ëŒ€ì—¬ ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return false;
            }

            if (!equipment) {
                showToast('ì¥ë¹„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return false;
            }

            if (!renterName) {
                showToast('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return false;
            }

            addRental(equipment, renterName);
            return false;
        }

        function updateEquipmentSelect() {
            var select = document.getElementById('equipment');
            select.innerHTML = '<option value="">ì¥ë¹„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';

            if (!startDate || !endDate) {
                return;
            }

            var equipmentNames = Object.keys(EQUIPMENT_CONFIG);
            for (var i = 0; i < equipmentNames.length; i++) {
                var name = equipmentNames[i];
                var total = EQUIPMENT_CONFIG[name];
                var status = equipmentStatus[name] || { normal: total, repair: 0 };
                var normalCount = status.normal || 0;

                // If no normal equipment available
                if (normalCount <= 0) {
                    var option = document.createElement('option');
                    option.value = name;
                    option.disabled = true;
                    option.textContent = name + ' (ì •ìƒ 0ëŒ€ - ëŒ€ì—¬ ë¶ˆê°€)';
                    select.appendChild(option);
                    continue;
                }

                var maxRented = 0;
                var checkDate = new Date(startDate);

                while (checkDate <= endDate) {
                    var dayRentals = getRentalsForDate(checkDate);
                    var rented = 0;
                    for (var j = 0; j < dayRentals.length; j++) {
                        if (dayRentals[j].equipment === name) {
                            rented++;
                        }
                    }
                    if (rented > maxRented) {
                        maxRented = rented;
                    }
                    checkDate.setDate(checkDate.getDate() + 1);
                }

                var available = normalCount - maxRented;

                var option = document.createElement('option');
                option.value = name;
                option.textContent = name + ' (ê°€ìš©: ' + available + '/' + normalCount + ')';

                if (available <= 0) {
                    option.disabled = true;
                    option.textContent = name + ' (ëŒ€ì—¬ ë¶ˆê°€ - ì¬ê³  ì—†ìŒ)';
                }

                select.appendChild(option);
            }
        }

        function addRental(equipment, renterName) {
            var startKey = formatDateKey(startDate);

            if (!rentals[startKey]) {
                rentals[startKey] = [];
            }

            var checkDate = new Date(startDate);
            while (checkDate <= endDate) {
                var dayRentals = getRentalsForDate(checkDate);
                var rented = 0;
                for (var i = 0; i < dayRentals.length; i++) {
                    if (dayRentals[i].equipment === equipment) {
                        rented++;
                    }
                }
                var status = equipmentStatus[equipment] || { normal: EQUIPMENT_CONFIG[equipment], repair: 0 };
                var normalCount = status.normal || 0;
                if (rented >= normalCount) {
                    showToast(formatDisplayDate(checkDate) + 'ì— í•´ë‹¹ ì¥ë¹„ì˜ ëŒ€ì—¬ ê°€ëŠ¥ ìˆ˜ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                checkDate.setDate(checkDate.getDate() + 1);
            }

            var newRental = {
                id: Date.now(),
                equipment: equipment,
                renterName: renterName,
                startDate: formatDateKey(startDate),
                endDate: formatDateKey(endDate),
                timestamp: new Date().toISOString()
            };

            rentals[startKey].push(newRental);

            saveRentals();
            updateEquipmentSelect();
            updateStatus();
            updateAlerts();
            renderCalendar();

            document.getElementById('equipment').value = '';
            document.getElementById('renterName').value = '';

            var days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            showToast(renterName + 'ë‹˜ì˜ ' + equipment + ' ' + days + 'ì¼ ëŒ€ì—¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function cancelRental(rentalId, startKey) {
            if (rentals[startKey]) {
                var rental = null;
                for (var i = 0; i < rentals[startKey].length; i++) {
                    if (rentals[startKey][i].id === rentalId) {
                        rental = rentals[startKey][i];
                        break;
                    }
                }

                var newList = [];
                for (var i = 0; i < rentals[startKey].length; i++) {
                    if (rentals[startKey][i].id !== rentalId) {
                        newList.push(rentals[startKey][i]);
                    }
                }
                rentals[startKey] = newList;

                if (rentals[startKey].length === 0) {
                    delete rentals[startKey];
                }

                saveRentals();
                updateEquipmentSelect();
                updateStatus();
                updateAlerts();
                renderCalendar();

                if (rental) {
                    showToast(rental.renterName + 'ë‹˜ì˜ ëŒ€ì—¬ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }
            }
        }

        // Status Functions
        function updateStatus() {
            var statusDateRange = document.getElementById('statusDateRange');

            // Get current month's first and last day from calendar
            var year = currentDate.getFullYear();
            var month = currentDate.getMonth();
            var monthStart = new Date(year, month, 1);
            var monthEnd = new Date(year, month + 1, 0);

            statusDateRange.textContent = '(' + year + 'ë…„ ' + (month + 1) + 'ì›”)';

            // Get all rentals that overlap with current month
            var displayRentals = [];
            var seen = {};

            var keys = Object.keys(rentals);
            for (var i = 0; i < keys.length; i++) {
                var dayRentals = rentals[keys[i]];
                for (var j = 0; j < dayRentals.length; j++) {
                    var rental = dayRentals[j];
                    if (seen[rental.id]) continue;

                    var rentalStart = new Date(rental.startDate);
                    var rentalEnd = new Date(rental.endDate);

                    // Check if rental overlaps with current month
                    if (rentalEnd >= monthStart && rentalStart <= monthEnd) {
                        seen[rental.id] = true;
                        displayRentals.push(rental);
                    }
                }
            }

            // Equipment Status Cards
            var statusContainer = document.getElementById('equipmentStatus');
            statusContainer.innerHTML = '';

            var equipmentNames = Object.keys(EQUIPMENT_CONFIG);
            for (var i = 0; i < equipmentNames.length; i++) {
                var name = equipmentNames[i];
                var total = EQUIPMENT_CONFIG[name];
                var status = equipmentStatus[name] || { normal: total, repair: 0 };
                var normalCount = status.normal || 0;

                // Count rentals for this equipment in current month
                var rentedCount = 0;
                for (var j = 0; j < displayRentals.length; j++) {
                    if (displayRentals[j].equipment === name) {
                        rentedCount++;
                    }
                }

                var available = normalCount - rentedCount;
                if (available < 0) available = 0;
                var percentage = normalCount > 0 ? (rentedCount / normalCount) * 100 : 0;

                var statusClass = 'status-available';
                if (normalCount <= 0) {
                    statusClass = 'status-full';
                } else if (percentage >= 100) {
                    statusClass = 'status-full';
                } else if (percentage >= 70) {
                    statusClass = 'status-warning';
                }

                var card = document.createElement('div');
                card.className = 'equipment-card';
                card.innerHTML = '<h4>' + name + '</h4>' +
                    '<div class="status-summary" style="margin-bottom:10px;">' +
                    '<span class="status-item normal">ì •ìƒ ' + status.normal + '</span>' +
                    '<span class="status-item repair">ìˆ˜ë¦¬ ' + status.repair + '</span>' +
                    '</div>' +
                    '<div class="status-bar"><div class="status-bar-fill ' + statusClass + '" style="width: ' + percentage + '%"></div></div>' +
                    '<div class="counts">' +
                    '<span>ëŒ€ì—¬: <span class="rented">' + rentedCount + '</span></span>' +
                    '<span>ê°€ìš©: <span class="available">' + available + '</span></span>' +
                    '<span>ì´: ' + total + '</span>' +
                    '</div>';
                statusContainer.appendChild(card);
            }

            // Rental List
            var listContainer = document.getElementById('rentalList');

            if (displayRentals.length === 0) {
                listContainer.innerHTML = '<div class="no-rentals">ëŒ€ì—¬ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            listContainer.innerHTML = '';

            var today = new Date();
            today.setHours(0, 0, 0, 0);

            displayRentals.sort(function(a, b) {
                return a.endDate.localeCompare(b.endDate);
            });

            for (var i = 0; i < displayRentals.length; i++) {
                var rental = displayRentals[i];
                var item = document.createElement('div');
                item.className = 'rental-item';

                var startD = new Date(rental.startDate);
                var endD = new Date(rental.endDate);
                endD.setHours(0, 0, 0, 0);

                var diffDays = Math.ceil((endD - today) / (1000 * 60 * 60 * 24));
                var daysLeftHtml = '';

                if (diffDays < 0) {
                    item.classList.add('overdue');
                    daysLeftHtml = '<span class="days-left danger">' + Math.abs(diffDays) + 'ì¼ ì´ˆê³¼</span>';
                } else if (diffDays <= 2) {
                    item.classList.add('returning-soon');
                    daysLeftHtml = '<span class="days-left warning">' + (diffDays === 0 ? 'ì˜¤ëŠ˜' : diffDays + 'ì¼ ë‚¨ìŒ') + '</span>';
                }

                item.innerHTML = '<div class="info">' +
                    '<span class="equipment-name">' + rental.equipment + '</span>' +
                    '<span class="renter-name">' + rental.renterName + '</span>' +
                    '<span class="rental-period">' + formatShortDate(startD) + ' ~ ' + formatShortDate(endD) + '</span>' +
                    daysLeftHtml +
                    '</div>' +
                    '<button type="button" class="cancel-btn" onclick="cancelRental(' + rental.id + ', \'' + rental.startDate + '\')">ì·¨ì†Œ</button>';

                listContainer.appendChild(item);
            }
        }

        // Equipment Management Functions
        function renderEquipmentManagement() {
            var container = document.getElementById('equipmentManagement');
            container.innerHTML = '';

            var equipmentNames = Object.keys(EQUIPMENT_CONFIG);
            for (var i = 0; i < equipmentNames.length; i++) {
                var name = equipmentNames[i];
                var total = EQUIPMENT_CONFIG[name];
                var status = equipmentStatus[name] || { normal: total, repair: 0 };

                var card = document.createElement('div');
                card.className = 'equipment-manage-card';

                card.innerHTML = '<h4>' + name + ' <span class="quantity">(ì´ ' + total + 'ëŒ€)</span></h4>' +
                    '<div class="status-summary">' +
                    '<span class="status-item normal">ì •ìƒ ' + status.normal + 'ëŒ€</span>' +
                    '<span class="status-item repair">ìˆ˜ë¦¬ì¤‘ ' + status.repair + 'ëŒ€</span>' +
                    '</div>' +
                    '<div class="status-controls">' +
                    '<div class="status-control-row">' +
                    '<label>ì •ìƒ:</label>' +
                    '<button type="button" onclick="adjustStatus(\'' + name + '\', \'normal\', -1)">-</button>' +
                    '<span id="count-' + name.replace(/\s+/g, '_') + '-normal">' + status.normal + '</span>' +
                    '<button type="button" onclick="adjustStatus(\'' + name + '\', \'normal\', 1)">+</button>' +
                    '</div>' +
                    '<div class="status-control-row">' +
                    '<label>ìˆ˜ë¦¬ì¤‘:</label>' +
                    '<button type="button" onclick="adjustStatus(\'' + name + '\', \'repair\', -1)">-</button>' +
                    '<span id="count-' + name.replace(/\s+/g, '_') + '-repair">' + status.repair + '</span>' +
                    '<button type="button" onclick="adjustStatus(\'' + name + '\', \'repair\', 1)">+</button>' +
                    '</div>' +
                    '</div>';

                container.appendChild(card);
            }
        }

        function adjustStatus(name, statusType, delta) {
            var status = equipmentStatus[name];
            var total = EQUIPMENT_CONFIG[name];

            var newValue = status[statusType] + delta;
            if (newValue < 0) {
                showToast('0 ë¯¸ë§Œìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            var otherSum = 0;
            var types = ['normal', 'repair'];
            for (var i = 0; i < types.length; i++) {
                if (types[i] !== statusType) {
                    otherSum += status[types[i]];
                }
            }

            if (newValue + otherSum > total) {
                showToast('ì´ ' + total + 'ëŒ€ë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            status[statusType] = newValue;
            equipmentStatus[name] = status;
            saveEquipmentStatus();
            renderEquipmentManagement();
            updateEquipmentSelect();
            updateStatus();
            showToast(name + ' ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // Dashboard Functions
        function renderDashboard() {
            var container = document.getElementById('dashboardGrid');
            container.innerHTML = '';

            // Only count rentals for current equipment config
            var allRentals = [];
            var keys = Object.keys(rentals);
            for (var i = 0; i < keys.length; i++) {
                var dayRentals = rentals[keys[i]];
                for (var j = 0; j < dayRentals.length; j++) {
                    var rental = dayRentals[j];
                    // Only include if equipment exists in current config
                    if (EQUIPMENT_CONFIG[rental.equipment] !== undefined) {
                        allRentals.push(rental);
                    }
                }
            }

            // Total Stats Card
            var statsCard = document.createElement('div');
            statsCard.className = 'dashboard-card';
            statsCard.innerHTML = '<h3>ì „ì²´ í†µê³„</h3>' +
                '<div class="stat-number">' + allRentals.length + '</div>' +
                '<div class="stat-label">ì´ ëŒ€ì—¬ ê±´ìˆ˜</div>';
            container.appendChild(statsCard);

            // Equipment Rental Count
            var equipmentCounts = {};
            var equipmentNames = Object.keys(EQUIPMENT_CONFIG);
            for (var i = 0; i < equipmentNames.length; i++) {
                equipmentCounts[equipmentNames[i]] = 0;
            }
            for (var i = 0; i < allRentals.length; i++) {
                if (equipmentCounts[allRentals[i].equipment] !== undefined) {
                    equipmentCounts[allRentals[i].equipment]++;
                }
            }

            // Top Equipment Card
            var sortedEquipment = Object.keys(equipmentCounts).sort(function(a, b) {
                return equipmentCounts[b] - equipmentCounts[a];
            });

            var topCard = document.createElement('div');
            topCard.className = 'dashboard-card';
            var topListHtml = '<h3>ì¸ê¸° ì¥ë¹„ TOP 5</h3><ul class="top-list">';

            for (var i = 0; i < Math.min(5, sortedEquipment.length); i++) {
                var name = sortedEquipment[i];
                var count = equipmentCounts[name];
                var rankClass = i === 0 ? 'gold' : (i === 1 ? 'silver' : (i === 2 ? 'bronze' : ''));

                topListHtml += '<li>' +
                    '<div style="display:flex;align-items:center;">' +
                    '<span class="rank ' + rankClass + '">' + (i + 1) + '</span>' +
                    '<span>' + name + '</span>' +
                    '</div>' +
                    '<span class="usage-rate">' + count + 'íšŒ</span>' +
                    '</li>';
            }

            topListHtml += '</ul>';
            topCard.innerHTML = topListHtml;
            container.appendChild(topCard);

            // Usage Rate Chart
            var usageCard = document.createElement('div');
            usageCard.className = 'dashboard-card';
            var usageHtml = '<h3>ì¥ë¹„ë³„ ëŒ€ì—¬ í˜„í™©</h3><div class="chart-container"><div class="bar-chart">';

            var maxCount = Math.max.apply(null, Object.values(equipmentCounts)) || 1;

            for (var i = 0; i < sortedEquipment.length; i++) {
                var name = sortedEquipment[i];
                var count = equipmentCounts[name];
                var percentage = (count / maxCount) * 100;

                usageHtml += '<div class="bar-item">' +
                    '<span class="bar-label" title="' + name + '">' + name + '</span>' +
                    '<div class="bar-track">' +
                    '<div class="bar-fill blue" style="width: ' + percentage + '%">' + count + '</div>' +
                    '</div>' +
                    '</div>';
            }

            usageHtml += '</div></div>';
            usageCard.innerHTML = usageHtml;
            container.appendChild(usageCard);

            // Monthly Stats
            var monthlyCard = document.createElement('div');
            monthlyCard.className = 'dashboard-card';

            var monthlyStats = {};
            var today = new Date();

            for (var i = 5; i >= 0; i--) {
                var d = new Date(today.getFullYear(), today.getMonth() - i, 1);
                var key = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0');
                monthlyStats[key] = 0;
            }

            for (var i = 0; i < allRentals.length; i++) {
                var monthKey = allRentals[i].startDate.substring(0, 7);
                if (monthlyStats[monthKey] !== undefined) {
                    monthlyStats[monthKey]++;
                }
            }

            var monthlyHtml = '<h3>ì›”ë³„ ëŒ€ì—¬ ì¶”ì´ (ìµœê·¼ 6ê°œì›”)</h3><div class="chart-container"><div class="bar-chart">';

            var monthKeys = Object.keys(monthlyStats);
            var maxMonthly = Math.max.apply(null, Object.values(monthlyStats)) || 1;

            for (var i = 0; i < monthKeys.length; i++) {
                var key = monthKeys[i];
                var count = monthlyStats[key];
                var percentage = (count / maxMonthly) * 100;
                var label = key.split('-')[1] + 'ì›”';

                monthlyHtml += '<div class="bar-item">' +
                    '<span class="bar-label">' + label + '</span>' +
                    '<div class="bar-track">' +
                    '<div class="bar-fill green" style="width: ' + percentage + '%">' + count + '</div>' +
                    '</div>' +
                    '</div>';
            }

            monthlyHtml += '</div></div>';
            monthlyCard.innerHTML = monthlyHtml;
            container.appendChild(monthlyCard);

            // Current Utilization
            var utilizationCard = document.createElement('div');
            utilizationCard.className = 'dashboard-card';
            var todayDate = new Date();
            var currentRentals = getRentalsForDate(todayDate);

            var totalEquipment = 0;
            var rentedEquipment = currentRentals.length;
            var equipNames = Object.keys(EQUIPMENT_CONFIG);
            for (var i = 0; i < equipNames.length; i++) {
                totalEquipment += EQUIPMENT_CONFIG[equipNames[i]];
            }

            var utilizationRate = totalEquipment > 0 ? Math.round((rentedEquipment / totalEquipment) * 100) : 0;

            utilizationCard.innerHTML = '<h3>í˜„ì¬ ê°€ë™ë¥ </h3>' +
                '<div class="stat-number">' + utilizationRate + '%</div>' +
                '<div class="stat-label">ì˜¤ëŠ˜ ê¸°ì¤€ (' + rentedEquipment + '/' + totalEquipment + 'ëŒ€ ì‚¬ìš©ì¤‘)</div>';
            container.appendChild(utilizationCard);
        }

        // CSV Export
        function exportToCSV() {
            var allRentals = [];
            var keys = Object.keys(rentals);
            for (var i = 0; i < keys.length; i++) {
                var dayRentals = rentals[keys[i]];
                for (var j = 0; j < dayRentals.length; j++) {
                    allRentals.push(dayRentals[j]);
                }
            }

            if (allRentals.length === 0) {
                showToast('ë‚´ë³´ë‚¼ ëŒ€ì—¬ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            allRentals.sort(function(a, b) {
                return a.startDate.localeCompare(b.startDate);
            });

            var csvContent = '\uFEFF';
            csvContent += 'ëŒ€ì—¬ì,ì¥ë¹„,ì‹œì‘ì¼,ì¢…ë£Œì¼,ëŒ€ì—¬ì¼ìˆ˜,ë“±ë¡ì¼ì‹œ\r\n';

            for (var i = 0; i < allRentals.length; i++) {
                var rental = allRentals[i];
                var startD = new Date(rental.startDate);
                var endD = new Date(rental.endDate);
                var days = Math.ceil((endD - startD) / (1000 * 60 * 60 * 24)) + 1;
                var timestamp = new Date(rental.timestamp).toLocaleString('ko-KR');

                csvContent += rental.renterName + ',' +
                    rental.equipment + ',' +
                    rental.startDate + ',' +
                    rental.endDate + ',' +
                    days + ',' +
                    timestamp + '\r\n';
            }

            try {
                var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });

                if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                    window.navigator.msSaveOrOpenBlob(blob, 'equipment_rental.csv');
                    showToast('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    return;
                }

                var url = URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = 'equipment_rental_' + formatDateKey(new Date()) + '.csv';
                link.style.display = 'none';

                document.body.appendChild(link);
                link.click();

                setTimeout(function() {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 200);

                showToast('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (error) {
                var newWindow = window.open('', '_blank');
                if (newWindow) {
                    newWindow.document.write('<pre>' + csvContent + '</pre>');
                    showToast('ìƒˆ ì°½ì—ì„œ CSV ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'success');
                } else {
                    showToast('ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }

        // Utility Functions
        function formatDateKey(date) {
            var year = date.getFullYear();
            var month = String(date.getMonth() + 1).padStart(2, '0');
            var day = String(date.getDate()).padStart(2, '0');
            return year + '-' + month + '-' + day;
        }

        function formatDisplayDate(date) {
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            var dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            return year + 'ë…„ ' + month + 'ì›” ' + day + 'ì¼ (' + dayNames[date.getDay()] + ')';
        }

        function formatShortDate(date) {
            return (date.getMonth() + 1) + '/' + date.getDate();
        }

        function showToast(message, type) {
            var toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type + ' show';
            setTimeout(function() {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
